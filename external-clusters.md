Externalized Compute Cluster

Product Requirement Document


### Overview

Externalized and Shared Compute Clusters are the future of the CDP data service architecture. 

**External Compute Clusters** will standardize our containerized platform for all data services. 

Administrators will be able to deploy a standard, uniform Kubernetes platform that can host any data services (like CDE, CML, CDW, or CDF) and shared services (like Airflow, Notebooks, Data Catalog, Data Sharing Server, Iceberg REST Catalog etc). This change will remove all inconsistent terminologies (e.g., private network vs private cluster) and provide the same features (e.g., UDR support) across all services. It will also provide a central management console for all operations, monitoring, and troubleshooting. 

This architecture offers administrators simplified management, enhanced efficiency, and centralized control, leading to quicker deployments, reduced configuration errors, and improved system reliability. 

Cloudera will also greatly benefit from the Externalized Compute Cluster architecture. Support matrixes can be streamlined, as the DSP team doesn’t need to cater to an ala-carte platform where data services pick and choose what platform features to enable within their service. This will enable shorter QA times and faster feature delivery while increasing product quality. 

\


**External Compute Clusters** will enable multiple instances and types of data services to share Compute Clusters. This architecture maximizes resource efficiency, reduces operational costs, and streamlines management.

With the streamlined operations and reduced costs of Shared Compute Clusters, Cloudera can claim lower TCO, increasing our competitiveness in the market. 

—----------------------------------------


### Proposed Solution

_Describe the solution in detail. Explain clearly how the feature will resolve the problem for our customers.  Outline the value and benefit customers get if we solve this problem._

Managing the lifecycle of an embedded compute cluster with various a la carte options used by current data services (CML, CDE, CDF) has been a fractured experience for our customers. Since each data service can today select different platform components a la carte, it becomes extremely complex to support deployment and upgrade of various cluster shapes and bloating up the support matrix. Simply put, the [Paradox of Choice](https://en.wikipedia.org/wiki/The_Paradox_of_Choice) applies aptly here.  

From a time-to-market perspective, Cloudera spends 4x the time to deliver a platform feature across all data services than it should otherwise take for each data service to integrate with a standard platform feature. This disjointed delivery prevents customers from adopting a unified architecture across their stacks, and data service management opex increases linearly with the breadth of service adoption.

Moreover, in the embedded mode, the lines between a Platform Admin role and a Data Practitioner role are blurred because the same persona needs to have expertise in Infrastructure requirements (Compute, Storage, Scale, Networking, Security) as well as Data Service Capabilities (Service features, Service How-to). 

All data services have an opinionated product page for deployment, management, and monitoring, which further increases the operational complexity of our platform. These pages are spread across the platform, providing an inconsistent, fragmented experience. Also, each service requires a different entitlement on the customer tenant to enable, in principle, the same feature. All of these contribute to the prolonged deployment times of the first containerized workload and lead to an elevated overall TCO due to the burdensome management involved.

Hence, a move away from embedded mode and the centralization of service operations and monitoring has become necessary and can be addressed by  “Data services **_supporting deployment_** on a **_standard_** (capabilities, parameters, upgrade process) **_external_** (separate lifecycle from data service) compute cluster using a central, uniform management interface”.

With externalized compute clusters, an Environment/PlatformAdmin installs and manages the Compute Cluster and authorizes a WorkloadAdmin to provision a data service on it within the same administration experience.

Further, **_default parameters are inferred from the Environment, enabling practically a “single-click” provisioning of both the externalized compute cluster and data service_** (with optional overrides). Most importantly, **_platform features are developed and released at the Compute Cluster level and are, therefore, available synchronously across each data service._** 

 


### Glossary

**The following is a subset copied from ..**

**Containerized Service** - A Cloudera Service that runs as a collection of container(s) inside a Kubernetes Cluster, This umbrella term can be used to refer to data services (DFX, CML, CDE, etc.) and metadata services alike (Containerized Data Lake, Data Catalog, etc.)

**Compute Cluster** - Cloudera’s abstraction of Kubernetes in Cloud (EKS, AKS). Containerized Services

run on a Compute Cluster, which can be - 

- **Embedded Compute Cluster** - A compute cluster whose lifecycle is managed by the hosted containerized service. An embedded compute cluster has no existence outside of the containerized service that manages it.

* **External Compute Cluster** - A compute cluster that is independent of any containerized service and exists independently as a first-class citizen. Its lifecycle is managed by the user instead of a containerized service. An External compute cluster can host one or more containerized service(s).

_Note:_ **_Compute Cluster in this PRD implies External Compute_** _unless explicitly specified otherwise. Embedded isn’t covered as a part of this doc._ **_Therefore, the term External will be omitted henceforth._**

**Environment “v2”** - The environment attribute to enable support for External Compute Clusters. See this [section](https://docs.google.com/document/d/1gHJHjOUZw7i3DxHm-LvJbFZO_EKCy_QRm0FkyDgnEXc/edit#heading=h.o7h7tl721osj) for a detailed description. **__**

**_Note -_** _This naming may change depending on feedback from peer Product Managers / Product Marketing. Concerns about using v2 and implying a versioning of Environment are enumerated at_ [_https://jira.cloudera.com/browse/CB-25498_](https://jira.cloudera.com/browse/CB-25498?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\&focusedCommentId=6638522#comment-6638522)_. A more precise and functional term such as_ **_container-ready_** _may take its place._ 

**Default Compute Cluster** - The **_first_** _compute cluster_ which is created implicitly upon setting Environment v2. This is a special cluster whose lifecycle is tied to the Environment, and can’t be stopped/ deleted ad-hoc. 

This cluster is meant for running critical applications such as Containerized Data Lake.

**Add-on Compute Cluster** - An **_optional, explicit, user-requested_** compute cluster that inherits configuration from the default compute cluster. This cluster may be stopped/resumed/deleted independent of Environment.

\



### Go-to-Market  _(Tier 1 Only)_

_Outline an external announcement on what you will be launching and why should our customers use the feature._

_Subheading 1_

_Subheading 2_

Unlocking a New Era of Data Management: Cloudera Launches Externalized Compute Cluster for fast-paced delivery of platform capabilities and reduced Operational Overhead.

\[Santa Clara, CA, January 2024] – Cloudera, a global leader in data management and analytics, is proud to announce the release of its Externalized Compute Cluster, designed to facilitate customers in deploying and leveraging their data assets. With this cutting-edge offering, Cloudera empowers businesses to provision their data services effortlessly while ensuring reliability and flexibility.

The Externalized Compute Cluster represents Operational Innovation in hosting and managing data services, enabling organizations to embrace the power of containerization for their data infrastructure. Built on Cloudera's legacy of reliability and innovation, this solution eases the operational overhead, reduces the total cost of ownership, provides for synchronized feature availability and standardizes the platform for all data services.

Key Advantages of Cloudera's Externalized Compute Cluster:

1.Scalability Beyond Limits: Organizations can now dynamically install a compute cluster with no-to-minimal inputs and share them between data services.

2.Accelerated feature delivery: There is a significant reduction in time-to-market for platform features as they’re now developed and tested at a unified layer.

3.Resource Efficiency: Shared mode maximizes resource utilization, allowing businesses to do more with less while minimizing operational overhead.

4.Rapid Deployment: Quick provisioning of compute clusters and ease of deploying data applications (practically a single-click), reduces time-to-insight in data-driven decision-making.

5.Seamless Integration: The Externalized Compute Cluster seamlessly integrates with Cloudera's comprehensive ecosystem with guaranteed compatibility with all data services, enabling users to leverage the full suite of data management and analytics tools.

6.Enhanced Security: Benefit from Cloudera's robust security and compliance features, ensuring that best security practices are followed by containerized applications..

"Cloudera is committed to pushing the boundaries of data management, and the launch of our Externalized Compute Cluster is a testament to that commitment," said Dipto Chakravarty, Chief Product Officer at Cloudera. "This solution makes it easier for organizations to deploy and manage containerized applications that can scale limitlessly while maintaining the reliability and security Cloudera is renowned for."

The Externalized Compute Cluster is poised to unlock new opportunities for organizations seeking to harness the power of their data. With containerization, Cloudera enables customers to achieve unprecedented agility and scalability in managing their data resources, and with externalized compute clusters, it makes managing containerized workloads just as easy as intuitive.

For more information about Cloudera's Externalized Compute Cluster and how it can transform your data infrastructure, please visit \[Product Landing Page] or contact \[Contact Information].

About Cloudera:

Cloudera is a leading global provider of data management and analytics solutions, empowering organizations to transform complex data into clear and actionable insights. Our platform provides the tools, capabilities, and expertise to drive innovation and achieve superior business outcomes.


###

### Key Customer(s) and business-case

|                    |                                                         |                      |
| ------------------ | ------------------------------------------------------- | -------------------- |
| #### Customer Name | #### Customer Problem or Opportunity                    | #### Business Impact |
|                    | _Describe the specific customer problem we’re solving._ |                      |


### Success Metrics

_Outline success metrics or technical preview exit criteria that indicate the internal goals for the project.  Maybe it’s the adoption of new features or additional revenue opportunities. But make sure the metrics are S.M.A.R.T._

|                                                                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| ------------------------------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Metric                                                             | Why this metric?                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | How do we influence it                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | How will we measure it?                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Cost savings (compute footprint)                                   | With sharing of compute clusters, customers can use the same EKS instance (Control Plane) and Infra Nodegroup for multiple data services.                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | Customers can try this feature as support for Shared Externalized Compute follows (Post 1st GA).Cloudera needs to provide clear guidelines on what SLAs customers can share  compute between applications.                                                                                                                                                                                                                                                                                                                                                           | Cloud Cost savings because of Sharing Compute Clusters                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Operations effort (upgrades, maintenance)                          | Any new platform feature needs n\*x work by each data service to support/test. Further a brand new data service has to do a lot of legwork to  expose all the platform capabilities that Liftie supports This is a huge operational overhead for Cloudera.In embedded mode, data service and Platform upgrades are combined (which take longer to finish).Also each data service and its cluster needs to be maintained individually by the same WorkloadAdmin (checking for EOL of a LTS Kubernetes release/ fixing CVEs in Infra helm charts, fixing CVEs in Kubernetes via ASG updates (patch releases)) | We separate the compute and data service upgrade - obfuscating the underlying complexities from WorkloadAdmin.We will also send alerts to compute cluster admins for which the k8s version is going EOL soon.In addition, we will streamline the process to fix Infra-charts CVEs.                                                                                                                                                                                                                                                                                   | From EDH, we would compare the upgrades metrics ex-post and ex-ante.This would include scheduling, time taken, success/failure, retries etc.We will ask for feedback from Customers engineers (WorkloadAdmin and EnvironmentAdmin persona) on whether the new process has advantages.                                                                                                                                                                                                                                                                                                                                                       |
| Reduced Time to market for new platform features                   | Individual data services adding support for a Kubernetes related feature (for example Azure Global DNS for Private AKS) at disjointed timelines is frustrating for customers who want to maintain the same architecture across their Stack and have to wait.                                                                                                                                                                                                                                                                                                                                                | Features will be developed and tested at Platform level and services will release compatibility at the same time.                                                                                                                                                                                                                                                                                                                                                                                                                                                    | Identifying a set of similar scale (effort-wise) issues before and after moving to an external compute cluster.For ex-ante , we would linearly combine the time it took different data service teams to do their own thing (DFX + CML + CDE) for a feature.For ex-post, we will measure the time taken by the single Compute team for development + service compatibility testing                                                                                                                                                                                                                                                           |
| Unified architecture (easier setup, unified cloud requirements, …) | Today, provisioning a data service requires \~ 10 parameters. What’s more confusing is different data services use different parameter names to expose the same capability.Also, data services running against the same environment can be brought up using different settings.In addition, the support for a platform feature is asynchronous across data services.                                                                                                                                                                                                                                        | Externalized Compute cluster would infer most necessary parameters (networking etc.) from the Environment Service as defaults. We could practically click a Create if we don’t need overrides, though the number of overrides too would be reduced.There would be standard name for the parameters on UI and CLI as describe [here ](https://docs.google.com/spreadsheets/d/107QiAdx4cY4wzTnATbOBAo1_ck7ki8RbBC6L9jJYqxg/edit#gid=0)Further customers will be able to use a Platform feature at the same time across every data service unifying their deployments.  | From EDH, ex-post we would analyze the average number of  overrides (if it is possible) for both compute clusters and data services.We will look at the number of customer cases citing delay of feature x for data service a,b…We will also check new feature release timelines ex-ante and ex-post for each data service. The timeline ex-ante would be from the time the first data service supporting the feature to all data services supporting the feature.For ex-post, it is a single point in timeWe will also look at the adoption delay (when customers start using it after the release) of the feature ex-ante and ex-post.    |
| Improved Success Rate of Data Service Provisioning                 | Today, data service provisioning failure may happen due to various underlying Kubernetes cluster provisions - Insufficient permissions, insufficient quotas, outages , flaky issues on Cloud Provider.                                                                                                                                                                                                                                                                                                                                                                                                      | We circumvent these when there’s an existing external compute cluster ready  to host services.Though, we could argue that we will still face them when creating the external cluster itself, but here too auto-inferring of parameters and enabling sharing would help. Further, a standardized  provisioning with inferred parameters would reduce compute cluster provisioning errors and accelerate identifying and remediation of issues (as they would be the same issues everywhere)                                                                           | EDH data for data service provisioning failure rates ex-ante and ex-post Externalized Compute Cluster support will be compared                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |


### Customer Research 

_Describe the customer research you’ve done, specific customers, anecdotes, and conversations and examples given by customers during your research._

From a customer perspective we increase the anxiety level as they have to consider various nuances and differences in user experience between data services inter-alia:

- Using different terminologies for the same capability (for example: Private Cluster for DFX vs Enable Fully Private Cluster for CML vs Enable Private Network for CDE).

- Asynchronous release timelines of the same capability across different services.

Feedback from customers supporting the argument :

- _“CML supports a fully private cluster but CDE does not… oh but wait CDE does support private network setup which essentially creates a private cluster. Different terminologies, different user experience argh!!!”_

* _“CDW supports custom docker registry but CML, CDE, CDF does not, sigh!!!”_

- _“When will I get support for UDR in CML, CDE, CDF? What, why would I get UDR support for CML in Q1, CDE in Q3 and CDF is on the roadmap? Aren’t these three data services using a common platform called Liftie? I am confused!!!”_

\


|               |         |        |
| ------------- | ------- | ------ |
| Customer Name | Request | Impact |
|               |         |        |


### Persona(s)

_Description of personas for this feature and the key persona we’re targeting._

The feature is being targeted for below personas.

- _EnvironmentAdmin (PlatformAdmin) - Usually Customer’s central infrastructure team working with Cloud Providers, SecOps, Finance and Engineering for:_

  - _Platform Requirements for Data Applications - Computing Power, Storage, Scaling, Cost etc._

  - _Security and Networking - Private networks, Encryption, Proxies, Firewalls etc._

  - _Evaluation of Cloud Service Providers for required technologies_

- _WorkloadAdmin - Data Engineers / Data Analysts provisioning and using the tools offered by the Cloud Service Providers._

 __


### Specific User Scenarios & Use Cases

_Outline specific scenarios and use cases of how users will interact with this feature. Where possible, describe specific customers, metrics, scale, how long tasks should take to complete. That detail will help engineering and QE scope, design, and test the feature._

|                                                                 |                                                                                                                                                          |
| --------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Scenario / Use Case                                             | Description                                                                                                                                              |
| Creation of default compute cluster for CDL                     | A default cluster will be created for all new environments … (assuming that …)                                                                           |
| Adding new compute clusters to a v2  environment                |                                                                                                                                                          |
| Adding data service to compute cluster                          |                                                                                                                                                          |
| Monitoring                                                      |                                                                                                                                                          |
| Troubleshooting                                                 |                                                                                                                                                          |
| View compute cluster details                                    | Administrators are looking to look into the specifics of a compute cluster where they can review its configuration, health, and deployed data services.  |
| Upgrade a compute cluster                                       | CVEs, service packs, k8s version upgrades, features                                                                                                      |
| Upgrade data service running on compute cluster                 |                                                                                                                                                          |
| Change configuration of compute cluster                         |                                                                                                                                                          |
| Change configuration of data service running on compute cluster |                                                                                                                                                          |
| Backup                                                          |                                                                                                                                                          |
| Delete data service from the compute cluster                    |                                                                                                                                                          |
| Delete a compute cluster                                        |                                                                                                                                                          |

\
\



### Messaging & Example Customer Quotes

_Outline of the product messaging our marketing team will use to describe this product to new and existing customers._

\
\
\
\
\
\
\
\
\
\
\



### Requirements

_These are the distinct, prioritized requirements and a short explanation of why they are important. Once the requirements have been gathered, ensure that discussions with Engineering are complete and record the response._


##### v2 Environments

**_We’re marking the Environment “v2” depending on whether the externalized compute clusters are enabled for the Environment._**

|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |   |   |   |   |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | - | - | - | - |
| What does “Environment v2” mean?It’s critical to clarify the exact scope of “v2”. Before getting into what it is, **_we should enumerate what it isn’t:_*** Not a new version of Datalake

* Not CDL

* Not a new version of SDX

* Not a collection of CDL and Metadata services (Airflow, CMLSA etc.)That is, **simply setting “environment v2” doesn’t dictate the provisioning sequence downstream.** What “Environment 2.0” is:* A new platform version which lets customers manage Compute Resources for Data applications - and share them between applications.

* A platform version **needed** for CDL

* A platform version **needed** for SDX (a collection of CDL and metadata services - Data Catalog, Data Sharing Server etc.)

* A platform version **needed** for newer Data Applications (Airflow, CMLSA, VIzApp etc.)**_Can environment v2 be enabled for legacy environments (VM based data-lakes)?_**Yes, customers can enable “environment v2” for already running environments. This will let customers deploy current data services (CDE, CML, CDF) **and** future services (Data Catalog, CML Model Serving, Airflow xyz) on the new platform, along with the platform capabilities described in this document. However, CDL itself **cannot** be deployed on legacy environments. And there may be some applications which require CDL ( we don’t know this yet ), and hence **can’t** be provisioned with legacy environments. **_Will environment v2 be the default way of creating environments ?_**No, unless there’s a compelling reason (for example - we push only CDL creations), Non environment v2 will still remain the default. Environment v2 clusters come with additional default compute cluster footprint (EKS Control Plane for AWS, AKS control plane + Infra nodes for Azure). Customers who are okay using our product as it is today won’t be forced to create environment v2 Environments. But availability of new services only on environment v2,  and success metrics described above should convince customers to __**_choose_** environment v2.  |   |   |   |   |

_Note: Compute Cluster here implies Externalized Compute unless explicitly specified otherwise. Embedded isn’t covered as a part of this doc._

__


##### Basic Platform Requirements

|       |          |                                                                                                                                                                                                                                                                                                                                                                                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                                                                                                                                                                                                                                                                                                                            |
| :---: | -------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
|   #   | Priority | Requirement                                                                                                                                                                                                                                                                                                                                                                           | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | Engineering Response                                                                                                                                                                                                                                                                                                       |
|  R01  | P1       | A  Shared default compute cluster is always created for v2 Environments.                                                                                                                                                                                                                                                                                                              | _The first compute cluster in a v2 ENV is the special cluster called default-compute-cluster._ **_ENVs are deemed “v2”_** _either by explicit creation or by updating an existing ENV’s version_ Any required environment-level parameters should be collected by the creation wizard for v2 Environments.                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | OK                                                                                                                                                                                                                                                                                                                         |
| R01.1 |          | CDL will only run on v2 ENV’s default compute cluster. Non v2 ENVs won’t have the option to enable CDL                                                                                                                                                                                                                                                                                | During datalake creation, users will be able to select the Containerized Data Lake option. This option can only be selected on v2 EnvironmentsIf this is selected, the creation wizard should provision the CDL application on the default compute cluster.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | OK                                                                                                                                                                                                                                                                                                                         |
| R01.2 |          | Some new metadata service(s) can only run on v2 ENV’s default compute cluster                                                                                                                                                                                                                                                                                                         | Airflow for example.CMLSA may run in dedicated mode on its own externalized compute cluster.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | OK                                                                                                                                                                                                                                                                                                                         |
|  R03  | P1       | **Allow adding** additional external compute clusters to v2 environments beyond the default compute cluster                                                                                                                                                                                                                                                                           | We need to make sure the cloud setup and the environment configuration allows this.Environment Level parameters should be inferred and taken as meaningful defaults  during compute cluster creation. These include inter-alia:* Node subnets

* Load Balancer Subnets

* Load Balancer Authorized IP RangesThe compute service must support adding any required parameters via environment edit (UI and CLI). These parameters may include:* Private Kubernetes Cluster

* Kubernetes API Server Authorized IP Ranges

* Overriding inferred parameters from Environment                                                                                                                                                                                                       | OK                                                                                                                                                                                                                                                                                                                         |
|  R04  | P1       | Allow conversion of existing (Non v2) Environments to v2 Environments.                                                                                                                                                                                                                                                                                                                | Customers will be able to leverage externalized compute clusters for their already running production environments (assuming that the version of the data lake is 7.2.x, etc).To do so, they will need to update the Environment Version to v2.A default compute cluster will be created as a result of this conversion.Cluster-level parameters should be specified                                                                                                                                                                                                                                                                                                                                                                                                            | OK                                                                                                                                                                                                                                                                                                                         |
|  R05  | P1       | Users should be able to clearly see what compute clusters are running in their v2 CDP  environments..                                                                                                                                                                                                                                                                                 | The CDP environment details screen should provide a way for the user to clearly see all compute clusters within that v2 environment in a list view\.From the list view they should be able to open the details of each compute cluster.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | OK                                                                                                                                                                                                                                                                                                                         |
|  R06  | P1       | Users should be able to clearly see the details of each compute cluster.                                                                                                                                                                                                                                                                                                              | Following key information should be shown to the user on UI and CLI- Cluster Name

- Environment name* Cluster Version

* K8s version

* Cluster configuration                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | OK                                                                                                                                                                                                                                                                                                                         |
|  R07  | P1       | Users should be able to clearly see what Data Service and shared service applications are running in the v2 CDP environment.                                                                                                                                                                                                                                                          | Data services (CML, CDF etc.) and Shared services (Airflow, notebook etc.) associated with the v2 environment should be shown to the user and exposed via CDP CLI                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | OK                                                                                                                                                                                                                                                                                                                         |
|  R08  | P1       | Users should be able to clearly see what Data Service / Shared service applications are running on a particular compute cluster in a v2 Environment.                                                                                                                                                                                                                                  | A description of compute cluster should also list the running applications.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | OK                                                                                                                                                                                                                                                                                                                         |
|  R09  | P1       | Clearly define roles and the distinction thereof between EnvironmentAdmin and WorkloadAdmin                                                                                                                                                                                                                                                                                           | Compute Cluster CRUD **would only be allowed by EnvironmentAdmin**WorkloadAdmin **will only be able t**o request **a workload (service) CRUD** on an existing Compute Cluster and will need to ask EnvironmentAdmin for actions on Compute (create, upgrade etc.)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | OK                                                                                                                                                                                                                                                                                                                         |
|  R10  | P1       | To add a Data Service to an external compute cluster, the user must have **both** a WorkloadAdmin (e.g. CMLAdmin) role **and** be in **ComputeClusterUser** Resource Role in a selected compute cluster.EnvironmentAdmin should be able to delegate the ComputeClusterUser rights to WorkloadAdmin for a specific Compute Cluster (depends on Management Console RBAC functionality). | Authorization to Workload Admin would be over a specific compute cluster resource(s) instead of at environment level.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | OK                                                                                                                                                                                                                                                                                                                         |
|  R11  | P1       | WorkloadAdmin should be able add service on the authorized compute cluster resource.                                                                                                                                                                                                                                                                                                  | If there are one or more compute clusters available -  WorkloadAdmin should be able select and add service on the compute cluster.Service specific (Nodegroup level) configuration parameters should be taken:* Nodegroup sizing

* Instance Type

* Autoscaling

* NFS for CML                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | OK                                                                                                                                                                                                                                                                                                                         |
|  R12  | P1       | If there’s no compute cluster available matching request - WorkloadAdmin should be notified to request EnvironmentAdmin for one.                                                                                                                                                                                                                                                      | This is needed to decouple process (authorization boundary, configuration, lifecycle) of Platform vs Application(Service)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | OK (UX change)                                                                                                                                                                                                                                                                                                             |
|  R13  | P1       | WorkloadAdmin (DFAdmin, CMLAdmin etc.) should be able to list available compute clusters to launch application                                                                                                                                                                                                                                                                        | A list should be shown of:* External  compute clusters

* Workload Admin should have access on the compute cluster resource

* Compute Cluster should have a compatible versionNote- Until an application has not been tested to work in Shared mode - workflows will be built to display the right information.                                                                                                                                                                                                                                                                                                                                                                                                                                                                | OK                                                                                                                                                                                                                                                                                                                         |
|  R14  | P1       | WorkloadAdmins should be able to list available Application (Service) Upgrades                                                                                                                                                                                                                                                                                                        | Information including:* Available Versions

* Features / bug fixes

* Compatible compute cluster (k8s) versions                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | OK                                                                                                                                                                                                                                                                                                                         |
|  R15  | P1       | WorkloadAdmin should be able to perform Application(service) upgrades which don’t need compute cluster upgrade.                                                                                                                                                                                                                                                                       | Service(application) upgrades should remain a jurisdiction of WorkloadAdmins                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | OK                                                                                                                                                                                                                                                                                                                         |
|  R16  | P1       | WorkloadAdmin should not be able to upgrade an application(service) which is not compatible with the current platform (k8s) cluster.                                                                                                                                                                                                                                                  | EnvironmentAdmin should be requested for the  dependent external compute cluster Upgrade.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | OK                                                                                                                                                                                                                                                                                                                         |
|  R17  | P1       | EnvironmentAdmin should be able to perform an infra-chart only upgrade for CVE fixes                                                                                                                                                                                                                                                                                                  | Infra charts will be owned by the Compute Cluster and applying CVE fixes is a shared responsibility.Infra charts upgrades don’t need an underlying k8s upgrade - therefore can be decoupled.Therefore, we need to expose at-least an API so that the EnvironmentAdmin can perform the upgrade.In addition, we would also need to show that information to the EnvironmentAdmin - if not on the CDP UI, this can be in Cloudera docs public release or via email or via account engineers.                                                                                                                                                                                                                                                                                       | OK Infra chart versions will be fixed. Only CVEs , not feature releases,But have instances when CVEs were fixed with feature releases, but these are exceptions?                                                                                                                                                           |
| R17.1 | P1       | EnvironmentAdmin should be able to perform an AMI only upgrade for CVE fixes                                                                                                                                                                                                                                                                                                          | AMIs will be owned by Compte Service and applying fixes is a shared responsibility.AMI updates don’t need an underlying k8s upgrade.Therefore we need to expose an API and UI to the EnvironmentAdmin to update to the latest AMIs.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | OK (Taken from [MVP Plan](https://docs.google.com/presentation/d/1y54msL9g7qCmN7ExGADe_OskMuJzVg_CT5H-DkGe4sw/edit#slide=id.g59ca3f81fc_2_1894))                                                                                                                                                                           |
|  R18  | P2       | EnvironmentAdmin should be able to list available Compute Cluster Upgrades.                                                                                                                                                                                                                                                                                                           | Kubernetes upgrades (important features and fixes) should be shown to environment admins.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | OK                                                                                                                                                                                                                                                                                                                         |
|  R19  | P2       | EnvironmentAdmin should be shown a list of data service upgrades (bridge releases) required for a Shared compute cluster upgrade.                                                                                                                                                                                                                                                     | All data services will need to have a bridge release - a service version which works on both current and next Kuberentes version.Before performing the compute cluster upgrade, all currently running services on the cluster not on a bridge release will need to be  upgraded first to a bridge release followed by the compute cluster upgrade.Compute Cluster Upgrades will remain BLOCKED till all data services / shared services have had a public bridge release.                                                                                                                                                                                                                                                                                                       | OK                                                                                                                                                                                                                                                                                                                         |
|  R20  | P2       | EnvironmentAdmin should be able to trigger a compute cluster upgrade when all dependencies are met . Note: ROLLBACK is NOT allowed from EKS **after a successful upgrade.**                                                                                                                                                                                                           | When all services are on a bridge release, a compute cluster upgrade can be initiated. Our product, however, should make a ROLLBACK available in an indirect way - via backup/restore or using side-by-side upgrades or any other means. This is to be discussed in detail when there is progress on LTS and Upgrades.                                                                                                                                                                                                                                                                                                                                                                                                                                                          | OK                                                                                                                                                                                                                                                                                                                         |
|  R21  | P2       | EnvironmentAdmin should be able to retry a failed external compute cluster upgrade.Note: ROLLBACK is NOT allowed from EKS **after  a successful upgrade.**                                                                                                                                                                                                                            | Upgrades should be made idempotent so they can be retried when there’s a failure. Our product, however, should make a ROLLBACK available in an indirect way - via backup/restore or using side-by-side upgrades or any other means. This is to be discussed in detail when there is progress on LTS and UpgradesHaving ROLLBACK will help us get-out of a situation when we keep hitting failures without needing an intervention.                                                                                                                                                                                                                                                                                                                                              | OK (but detailed discussions required about upgrade design). I.e does idempotency apply to side-by-side upgrade?                                                                                                                                                                                                           |
|  R22  | P2       | Externalized compute clusters will always use underlying EKS/AKS LTS releases and upgrades will only be supported from LTS -> LTS.                                                                                                                                                                                                                                                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | OK                                                                                                                                                                                                                                                                                                                         |
|  R23  | P1       | EnvironmentAdmin should be able to grant remote cloud user access on an external compute cluster Kubernetes API Server to debug Workload issues (_preferably at namespace level)._                                                                                                                                                                                                    | Granting remote user access to Kubernetes API Server should be in jurisdiction of EnvironmentAdmin                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | OK (but need to decide if namespace scoping is in MVP)                                                                                                                                                                                                                                                                     |
|  R24  | P1       | EnvironmentAdmin should be able to download KUBECONFIG of the compute cluster scoped at Full Cluster.                                                                                                                                                                                                                                                                                 | This is required for debugging /checking logs of Infra-chart deployments.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | OK                                                                                                                                                                                                                                                                                                                         |
|  R25  | P1       | WorkloadAdmins should be able to download KUBECONFIG of the compute cluster running the Application(Service) (scoped at the service namespace preferably)                                                                                                                                                                                                                             | This is required for debugging / checking logs of a service instance.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | OK                                                                                                                                                                                                                                                                                                                         |
|  R26  | P1       | WorkloadAdmin should be able to delete/remove a data service from a compute cluster (except CDL)                                                                                                                                                                                                                                                                                      | WorkloadAdmin has control over the workload lifecycle.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | OK                                                                                                                                                                                                                                                                                                                         |
|  R27  | P1       | CDL Application should be prevented against accidental deletes by DLAdmin                                                                                                                                                                                                                                                                                                             | To prevent leaking resources as services won’t function without a datalake. Should we set a WARNING or BLOCK? we have 2  options:1. Not let the DLAdmin delete CDL at all - have it in environment deletion flow implicitly2. Let DLAdmin delete CDL only with --force flag.The existing API (delete-datalake) will remain the same in both but implementation would change to reflect the “special” status of CDL.                                                                                                                                                                                                                                                                                                                                                             | OK but this is CDL specific.                                                                                                                                                                                                                                                                                               |
|  R28  | P1       | EnvironmentAdmin can initiate a delete of external compute cluster except the default external compute cluster for CDL via Compute API                                                                                                                                                                                                                                                | A non-default external compute cluster can be deleted by EnvironmentAdmin. If there are hosted data services, a clear WARNING would be shown and we’ll ask for consent again before triggering deletion. Or –force-deletion flag would delete non-default clusters irrespective.**Note: Compute Cluster can’t be deleted while it’s still under creation.**                                                                                                                                                                                                                                                                                                                                                                                                                     | Assumption: All data services have a force delete option.OK                                                                                                                                                                                                                                                                |
|  R29  | P1       | Default External Compute Cluster  would be protected against accidental delete by EnvironmentAdmin                                                                                                                                                                                                                                                                                    | If the default compute cluster for CDL is deleted , then CDL can’t be recovered / there would certainly be downtime. Therefore we need the deletion protection.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | OK                                                                                                                                                                                                                                                                                                                         |
| R29.1 | P3       | Allow conditional Conversion of v2 Environments to Non v2                                                                                                                                                                                                                                                                                                                             | Customers who are on VM based datalakes and moved to v2 for experimenting with externalized compute clusters shouldn’t be left in a state where they’ve to delete the production environment to get rid of the running EKS.Therefore, a reverse conversion from v2 to Non v2 should be possible **_provided that there aren’t any services hosted on the default compute cluster._**                                                                                                                                                                                                                                                                                                                                                                                            |                                                                                                                                                                                                                                                                                                                            |
|  R30  | P1       | Environment deletion should implicitly remove non-default compute clusters, CDL and default compute cluster                                                                                                                                                                                                                                                                           | This is in-line with the default compute cluster lifecycle being tied to the environment lifecycle. It should:- Delete all non-default compute clusters.* Delete CDL on the default compute cluster

* Delete the default compute cluster

* Delete environment (FreeIPA)**Note: Compute cluster can’t be deleted while it’s still under creation. This applies to both default and additional compute clusters.****Therefore, environment delete should explicitly FAIL in such a case with an error message.****We shouldn’t ignore it, leaving resources behind.**Note: CB team has added a waiting mechanism which waits for a maximum of 30 minutes for a delete request to be accepted by Liftie. If the request isn’t accepted by Liftie after 30 min, the delete fails. | OK                                                                                                                                                                                                                                                                                                                         |
|  R31  | P1       | Users should be able to create, view and delete computer clusters using Terraform.                                                                                                                                                                                                                                                                                                    | A compute cluster resource has to be implemented in the Terraform Provider for CDP.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | OK                                                                                                                                                                                                                                                                                                                         |
|  R32  | P2       | v2 environments should offer fault tolerance even in case of AZ failures. Critical services need to remain functional during an AZ outage.Kubernetes NodeGroup for Data Service should be deployed Multi-AZ for fault-tolerance if it is selected while service provisioning.CDL NodeGroups should be deployed Multi-AZ provided the v2 CDP Environment is configured for Multi-AZ.   | Liftie already supports this and we should make it default to mitigate AZ outage.We need to define the services running on the v2 environment (default compute cluster) that are fault tolerant (e.g. CDL, Airflow, Model Serving) and those not.Those that are / are not should be captured as a known limitation and published in our public documentation.                                                                                                                                                                                                                                                                                                                                                                                                                   | OKEngineering Feedback - Need to provide that as an option at application level.**_Should always be multi-AZ for CDL provided that the CDP environment is configured successfully for multi-az_**.Liftie doesn’t support multi-az on Azure by default.Some services explicitly ask for single zone NodeGroup (example CML) |
|  R33  | P1       | Enable Encryption always for External Cluster (K8S Secrets & Volume Encryption) with option to provide Customer Managed Keys                                                                                                                                                                                                                                                          | Encryption keys can be managed by a cloud provider or user.If Environment is CMK enabled, it should take the same key as default for secrets and volumes.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | OK                                                                                                                                                                                                                                                                                                                         |
|  R34  | P2       | EnvironmentAdmin should be alerted on the UI to upgrade all compute clusters which may be near EOL.                                                                                                                                                                                                                                                                                   | For compute clusters on an end-of-life Kubernetes version on EKS/AKS, an alert should be sent to EnvironmentAdmin(s) to upgrade them.Cloudera should have already done bridge releases for all data services by this point.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | OK                                                                                                                                                                                                                                                                                                                         |
|  R35  | P1       | A stop command issued on v2 CDP Environment should also stop associated compute clusters.                                                                                                                                                                                                                                                                                             | For EKS, the kubernetes control plane will still be running in the background.For AKS there would be a complete shutdown - TBD.Pre-req: * Need to test whether services can re-run from the saved state in AKS

* Need to check whether services can re-run when the worker nodes are upscaled from 0 to n.                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | OK                                                                                                                                                                                                                                                                                                                         |
|  R36  | P2       | EnvironmentAdmin should be allowed to suspend and resume non-default compute clusters.                                                                                                                                                                                                                                                                                                | For EKS, the kubernetes control plane will still be running in the background.For AKS there would be a complete shutdown.Pre-req: * Need to test whether services can re-run from the saved state in AKS

* Need to check whether services can re-run when the worker nodes are upscaled from 0 to n.                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | OK                                                                                                                                                                                                                                                                                                                         |
|  R37  | P2       | All workload UI/APIs to be fronted by Knox SSO                                                                                                                                                                                                                                                                                                                                        | While Knox gateway proxy fronts UI/APIs for Datalake, Datahub, data services ingress has been separate (relying on custom cookies). Knox SSO would make it easier for users to use the same credentials throughout our stack.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | OK                                                                                                                                                                                                                                                                                                                         |
|  R38  | P2       | EnvironmentAdmin should be able to send a notification to WorkloadAdmin to upgrade an application(service) when it’s blocking a Shared Compute Cluster Upgrade                                                                                                                                                                                                                        | If EnvironmentAdmin decides to upgrade a Shared Compute Cluster because of EOL or a prerequisite for upgrading Service X, he should be able to notify a WorkloadAdmin for Service Y,Z etc. running in the same compute cluster and not yet on a bridge release.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | OK                                                                                                                                                                                                                                                                                                                         |
|  R39  | P3       | Compute Cluster should enable Resilient and ZDU App-only upgrades for hosted applications.                                                                                                                                                                                                                                                                                            | App upgrades not needing an underlying compute cluster upgrade should be done in a resilient and ZDU manner and the compute cluster should provide required capabilities.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | OK                                                                                                                                                                                                                                                                                                                         |
|  R40  | P3       | Compute Cluster Upgrade should enable Resilient and ZDU path for hosted applications (data services)                                                                                                                                                                                                                                                                                  | Kubernetes API Server and Node Groups upgrade should be done without impacting running data services..                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | OK                                                                                                                                                                                                                                                                                                                         |
|  R41  | P3       | A user having both EnvironmentAdmin and WorkloadAdmin should be able to perform both Compute Cluster and Application(Service) CRUD in a single action on the UI.This is for ease-of-use for onboarding /  POCs / getting first workload running.                                                                                                                                      | This includes* Performing application and platform upgrade together (latter first)

* Creating compute cluster and application together

* Deleting application and compute cluster togetherThis won’t be a new API but an authorization check followed by orchestration over existing APIs. Though this may not be what’s recommended as the role separation disappears.                                                                                                                                                                                                                                                                                                                                                                                                       | OK                                                                                                                                                                                                                                                                                                                         |


##### Data Service Requirements List

To be added by [Jaimin Jetly](mailto:jaimin@cloudera.com)

Kubernetes beta APIs complicate LTS upgrades.


##### Upgrade and Migration Requirements

_List any backward compatibility or forward compatibility issues._

|     |          |                                                                                                                                                                                                                                                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                     |
| --- | -------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| #   | Priority | Requirement                                                                                                                                                                                                                                                    | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Engineering Response                                                                                                                                                |
| UR1 | P1       | Enable CDL for  v2 environments                                                                                                                                                                                                                                | CDL can only be created for v2 environments. Customers looking to upgrade to CDL will need to first convert their existing Environment to v2                                                                                                                                                                                                                                                                                                                                                                                                 | OK                                                                                                                                                                  |
| UR2 | P1       | All data services should work with a common set of capabilities decided as an outcome of discussion between Liftie and Data Service Teams inter-alia:* Internal Service Routing (istio)

* Autoscaler (Yunikorn vs default autoscaler)

* Infra Chart versions | This is table stakes for a Shared Compute Cluster Model. Our goal is to release capabilities at platform level which will be available/consumed by all data/shared services.Therefore, we need to set a baseline with current capabilities by checking compatibility and requirements of CML, CDE and CDF.                                                                                                                                                                                                                                   | OK                                                                                                                                                                  |
| UR3 | P1       | Program management effort for bridge releases for all data services before every Kubernetes Minor Version EOL or LTS expiry.                                                                                                                                   | A minor version is under standard support in Amazon EKS for the first 14 months after it's released. Once a version is past the end of standard support date, it automatically enters extended support for the next 12 months.We should give sufficient time to customers to upgrade their data services with all bridge releases (ideally not lagging by a few weeks) before upgrading to a major version of the compute cluster (Kubernetes). We should definitely not be in a situation where we are BLOCKED because of a single service. | Upgrades won’t be there for \~1 year..                                                                                                                              |
| UR4 | P2       | Hosted data services should not interact with cloud resources only via restricted IAM roles/permissions assigned to Compute Service (Liftie)                                                                                                                   | This has been the credential role for a long time until we had Restricted IAM Policy in AWS and Liftie Managed Identity in Azure as the equivalent.We would want to use the Restricted Roles, so those permissions would need to be added to restricted IAM policy.This will **need a TSB for customers** to update their Restricted IAM Role’s Policies but helps to standardize things looking forward.                                                                                                                                    | TBD ( CDL and SecOps team may have some directions to achieve similar outcome )Slack discussion: https\://cloudera.slack.com/archives/C0682G50NG3/p1708538913462329 |
| UR5 | P3       | Clear process for a data service deprecation.                                                                                                                                                                                                                  | If a data service needs to be deprecated (there won’t be any new release) - then shared compute cluster upgrades shouldn’t be blocked in absence of such a bridge release and customers would be required to uninstall data service being deprecated before doing a platform upgrade.                                                                                                                                                                                                                                                        | OK. Not a likely scenario but this requirement is obvious.                                                                                                          |
| UR6 | P3       | Backup-restore from embedded mode to external mode                                                                                                                                                                                                             | CML has a backup-restore functionality which works in embedded mode but is yet to be tested if backup from embedded and restore to external works.                                                                                                                                                                                                                                                                                                                                                                                           | OK but not immediately addressable.Onus is on Applications.                                                                                                         |


### Upgrade Timeline 

[Jaimin Jetly](mailto:jaimin@cloudera.com) to provide timelines for milestones listed and what services need to implement to support ZDU.

**_Disclaimer - Once LTS versions are supported,  there won’t be any Platform (Kubernetes) Upgrades for \~1 year._**


### Out of Scope

_What have you explicitly decided not to do, and why?_

|       |                                                                                                       |                                                                                                                                                                                                                 |                      |
| ----- | ----------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------- |
| #     | Requirement                                                                                           | Description                                                                                                                                                                                                     | Engineering Response |
| OR101 | In-place migration of existing data services running in embedded mode to Externalized Compute Cluster | This is quite complex because already running data services would’ve used a la-carte capabilities exposed via Liftie, all of which wouldn’t have made it to Standard Capabilities in External Compute Clusters. | OK                   |


### Component Dependencies

How does this feature interact with other CDP components (e.g. Ranger, Knox, HDFS, CDF)?

|            |             |
| ---------- | ----------- |
| Dependency | Description |
|            |             |


### Customer Experience

#### Public API/CLI definitions

We need to differentiate between the default compute cluster that is automatically created when a v2 environment is set up and between additional compute clusters.


##### Decisions

Default compute cluster (v2)

- Do we want to 

* **(CHOSEN)** Include “default compute cluster” CRUD commands in the environment service and API, as it should be perceived by the user as part of the environment services. There is exactly 1 (logical) instance of this default / platform cluster.

or

- Have a separate default compute cluster public API → can be optional,

* Do we want to

- **(CHOSEN)** Suspend the default compute cluster only via cdp environment API.

- Suspend the default compute cluster via compute public API → This may cause downtime for associated data services / datahubs.

* Use-cases

  - It can be created together with the environment (P0) and deleted with the environment (P0)

  - It should be possible to create it (enable it) or remove it (disable it) afterwards for existing environments (P1)

Compute clusters

- Do we want to 

* Include compute cluster CRUD commands in the environment service and API 

or

- **(CHOSEN**) Have a separate compute cluster public API. Compute clusters will need to be exposed to Data Services, they have n instances, whereas environment is exactly 1 instance, etc.


##### Use-cases and for default compute clusters

- _P1 Create a v2 environment_

- _P1 Delete a v2 environment_

- _P2 Convert an existing Non v2 environment to v2 Environment_

- _P3 (TBD) Convert an existing v2 to Non v2 Environment_

CLI examples:

**_All actions below require an EnvironmentAdmin role._**

|                                                               |                                                                                                                                                                                                                                                                                                                                                                                                                      |
| ------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Item**                                                      | **CLI** **(Some parameters may only be exposed via Beta/Internal CLI - This is TBD)**                                                                                                                                                                                                                                                                                                                                |
| _Create a v2 environment_                                     | `cdp environments create-aws-environment``––environmentVersion v2``--compute-cluster-configuration=node-subnet-ids=<Inferred>,``--load-balancer-subnet-ids=<Inferred>,``kube-api-authorized-ip-ranges=<inferred>,``private-cluster=<optional>,``enable-public-endpoint-access=<optional>,``encryption-key-arn=<inferred>,``user-defined-routing=<optional>,``load-balancer-authorized-ip-ranges=<optional-inferred>` |
|                                                               |                                                                                                                                                                                                                                                                                                                                                                                                                      |
| _Delete a v2 environment_                                     | `cdp environments delete-environment…`                                                                                                                                                                                                                                                                                                                                                                               |
| _Convert an existing Non v2 environment to v2 Environment_ __ | `cdp environments update-configuration``--environmentVersion v2``--compute-cluster-configuration=node-subnet-ids=<Inferred>,load-balancer-subnet-ids=<Inferred>,kube-api-authorized-ip-ranges=<inferred>,private-cluster=<optional>,aks-private-dns-zone-id=<optional>,enable-public-endpoint-access=<optional>,encryption-key-arn=<inferred>,user-defined-routing=<optional>`                                       |
| _Convert an existing v2 to Non v2 Environment_                | `cdp environments update-configuration --environmentVersion null`                                                                                                                                                                                                                                                                                                                                                    |


##### Use-cases for all compute clusters

- _R05 (P1): List Compute Clusters for a CDP Environment_

- _R03 (P1): Add a compute cluster to a CDP Environment_

- _R06 (P1): Describe a Compute Cluster_ 

- _R07 (P1): List applications running on a compute cluster (TBD: if it needs a separate API than describe compute cluster)_

- _R27(P1): Remove a compute cluster_

- _(R23) (P1): Allow Remote Cloud User Access to Compute Cluster Kubernetes Server_

- _(R23) (P1): Download KUBECONFIG of a compute cluster_

- _P1: Authorize a WorkloadAdmin or a Group of WorkloadAdmins to manage a data/shared service on a compute cluster_

- _(R37) (P2) Suspend a Compute cluster_

- _(R36) (P2) Resume a Compute cluster_

**_Following items are a part of the upgrade story and will be finalized once there is more clarity around LTS and Upgrades design._**

- _R18 (P1): View available upgrades for a compute cluster_

- _R19 (P1): List data service bridge releases required for the compute cluster upgrade._  

- _R20 (P1): Upgrade a compute cluster (Kubernetes upgrade)_

- _R17 (P1): View available upgrades for infra-charts CVE fixes on the compute cluster._ 

- _R17 (P1): Do an infra-chart only upgrade on the compute cluster_ 

- _(R34) (P1)_ _List compute clusters which are nearing the end of Standard Support from EKS/AKS._

\
\


**The default compute cluster should also be returned in the response for List Compute Clusters. We need to decide whether other API commands of this Compute Cluster service should apply to it. Ideally, this default compute cluster should not be required to be user managed (automated updates, autoscaling, etc should eventually be supported).**

CLI examples:

**_All POST/UPDATE/DELETE actions below require an EnvironmentAdmin role._**

|                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| -------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Item**                                                                         | **CLI** **(Beta/Internal CLI only options are highlighted in Blue - these won’t be available in public external CLI unless customers explicitly ask for it)**                                                                                                                                                                                                                                                                              |
| _List Compute Clusters for a CDP Environment_                                    | `cdp compute list-clusters --environment-crn <env_crn>``    # Lists the default compute cluster as the first one here``    <...>`                                                                                                                                                                                                                                                                                                          |
| _Add a Compute Cluster to a CDP Environment_                                     | `cdp compute create-cluster ``--environment <env_crn>``--node-subnet-ids <optional - inferred from environment by default>``--load-balancer-subnet-ids <optional - inferred> ``--private-cluster <optional> ``--aks-private-dns-zone-id <optional>``--enable-public-endpoint-access <optional> ``--encryption-key-arn <optional-inferred> ``--user-defined-routing <optional>  ``—-load-balancer-authorized-ip-ranges <optional-inferred>` |
| _Describe a Compute Cluster_                                                     | `cdp compute describe-cluster –compute-cluster-crn <compute_cluster_crn>`                                                                                                                                                                                                                                                                                                                                                                  |
| _Suspend a Compute cluster_                                                      | `cdp compute suspend-cluster –compute-cluster-crn <compute_cluster_crn> `                                                                                                                                                                                                                                                                                                                                                                  |
| _Resume a Compute Cluster_                                                       | `cdp compute resume-cluster –compute-cluster-crn <compute_cluster_crn>`                                                                                                                                                                                                                                                                                                                                                                    |
| _Remove a compute cluster_                                                       | `cdp compute delete-cluster –compute-cluster-crn <compute_cluster_crn> –force <optional>`                                                                                                                                                                                                                                                                                                                                                  |
| _List applications running on a compute cluster_                                 | `cdp compute list-deployed-applications –compute-cluster-crn <compute_cluster_crn>`                                                                                                                                                                                                                                                                                                                                                        |
| _Allow Remote Cloud User Access to Compute Cluster Kubernetes Server_            | `cdp compute grant-user-kubernetes-access –compute-cluster-crn <compute_cluster_crn> –cloud-user-id <cloud_user_id> –namespace <optional>`                                                                                                                                                                                                                                                                                                 |
| _Authorize a WorkloadAdmin to manage a data/shared service on a compute cluster_ | `cdp compute grant-cluster-access –compute-cluster-crn <compute_cluster_crn> --user-crn\|--user-group-crn <user_group_crn>`                                                                                                                                                                                                                                                                                                                |
| _Download KUBECONFIG of a compute cluster_                                       | `cdp compute get-kubeconfig –compute-cluster-crn <compute_cluster_crn> `                                                                                                                                                                                                                                                                                                                                                                   |

\


**_Note:_** _The CLI examples listed here are only illustrative. The final command, subcommand and parameter names will be decided by Engineering._ 


##### Use-cases for Workload Administration

- _P1: List externalized compute clusters available for workload provisioning_ 

- _P1: Select an externalized compute cluster when deploying a data service_

\


CLI examples:

**_All  POST/UPDATE/DELETE actions below require a WorkloadAdmin role._**

|                                                                           |                                                                                                                                   |
| ------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------- |
| **Item**                                                                  | **CLI**                                                                                                                           |
| _List externalized compute clusters available for workload provisioning_  | `cdp <workload_placeholder> list-available-compute-clusters –env-crn <env_crn> `                                                  |
| _Select an externalized compute cluster when deploying a data service_    | `cdp <workload_placeholder> deploy-instance –compute-cluster-crn <compute_cluster_crn> --min-k8s-node-count --max-k8s-node-count` |

\



### UX for Application Provisioning on the External Compute Clusters - Proposal/Draft

Before externalized compute clusters, each data service had a CRUD application which - 

- Requested Liftie to provision a physical compute cluster with provided parameters, and also:

  - Created Liftie node group

  - Installed Liftie-infra charts

       (Common)

- Created Service node groups (if requested)

* Managed deployments (helm charts) on the Liftie provisioned k8s cluster.

       (Service Specific)

\


Externalized compute cluster will decouple these into layers demonstrated below:

(Referenced from [Jayush Luniya](mailto:jluniya@cloudera.com)’s design [here)](https://miro.com/app/board/uXjVKefghCk=/)

![](https://lh7-rt.googleusercontent.com/docsz/AD_4nXceJf9xWOjaW33e_aYPSXzoRPXtR_WIghj2lJcRcARyKlvkxIQxxR7NsZAQDs9M7lxH_wN4v1-G88IVMgZNgKWcSSW3P5gYp6RAzh4g7G6kxDvbABkOUri-sAj584xYNbQ6ho75eHx7l8n6Fbr8eM6TsfOd?key=IfBOgWCOphsauFycBxG7qw)

**_(Note- Ignore CDP Studio for this discussion)_** 


### **Layer 1 (Externalized Platform) -** The externalized compute cluster itself, composed of physical k8s cluster + Liftie infra node group + Liftie infra charts + resource management + Interfaces to external Database and Storage. 

Each application looking to be hosted on a running external compute cluster will get this platform out-of-the-box.


### **Layer 2 (Cloudera Service Manager - Optional)** -  Extended capability provided by Compute team to manage application dependencies (application nodegroups, application helm charts, application cloud prerequisites (RDS, Custom Encryption, NFS etc.) . The Cloudera Service Manager will understand application requirements via a spec file (mostly YAML) and translate them to actual resources.

Combined, Layer 1 and Layer 2 should **_replace_** the individual data service CRUD applications, and should be the default way of onboarding. But, for data services already having a CRUD application, this brings asymmetry in UX for embedded/ external mode and possibly requires more work to integrate into CSM.

Therefore, below options are provided to Applications (referenced from [Vinod Kumar Vavilapalli](mailto:vinodkv@cloudera.com)’s suggestion [here](https://docs.google.com/document/d/1G2xhnPUR1HRviakE2KOaJkUdPynm_JR4vmB-rd5E9fM/edit)) - 

- **Integrate at Layer 1** - Applications still relying on their own CRUD apps will do this. 

However, the scope of that CRUD app will change to manage only the application specific part described above. In other words, the CRUD app will not touch the externalized platform but use the provided k8s cluster details.

_For Example a DFX enable-service on External Compute Cluster will change from_  

```
COMMAND
	df
NAME
       enable-service - Enable DataFlow service from a CDP environment.
DESCRIPTION
       Enable DataFlow service from a CDP environment.
SYNOPSIS
            enable-service
          --environment-crn <value>
          --min-k8s-node-count <value>
          --max-k8s-node-count <value>
          --use-public-load-balancer | --no-use-public-load-balancer
          [--kube-api-authorized-ip-ranges <value>]
          [--tags <value>]
          [--load-balancer-authorized-ip-ranges <value>]
          [--cluster-subnets <value>]
          [--load-balancer-subnets <value>]
          [--private-cluster | --no-private-cluster]
          [--instance-type <value>]
          [--skip-preflight-checks | --no-skip-preflight-checks]
          [--user-defined-routing | --no-user-defined-routing]
          [--pod-cidr <value>]
          [--service-cidr <value>]
          [--cli-input-json <value>]
          [--generate-cli-skeleton]
```

_to_

```
COMMAND
	df
NAME
       enable-service - Enable DataFlow service from a CDP environment.
DESCRIPTION
       Enable DataFlow service from a CDP environment.
SYNOPSIS
            enable-service
          --environment-crn <value>
          --min-k8s-node-count <value>
          --max-k8s-node-count <value>
	   --compute-cluster-crn <value>
          [--instance-type <value>]
          [--skip-preflight-checks | --no-skip-preflight-checks]
          [--cli-input-json <value>]
          [--generate-cli-skeleton]
```

- **Integrate at Layer 2 (Preferred) -** Applications who don’t have a CRUD application, or have it outdated (lack ability to manipulate Cloud Resources, for example) can bank on Cloudera Service Manager as a common entrypoint to the externalized compute cluster. This will also let those applications use the Cloud Provider Interaction brokered in a standardized manner via CSM.

_For Example_

\


```
COMMAND
	service-instance
NAME
       create - Enable DataFlow service from a CDP environment.
DESCRIPTION
       Enable DataFlow service from a CDP environment.
SYNOPSIS
            create
	   --type DFX
          --environment-crn <value>
          --min-k8s-node-count <value>
          --max-k8s-node-count <value>
	   --compute-cluster-crn <value>
          [--instance-type <value>]
          [--cli-input-json <value>]
          [--generate-cli-skeleton]
```

**Soft Managed (Pseudo) Layer 2 Integration** - Even if an application integrates at Layer 1, there will be a “soft pseudo-integration” at Layer 2. Customers will have the same entrypoint to the external compute cluster (via service-instance) but the request will be served by the application specific CRUD app at the backend (invisible to customers). 

This not only provides for uniform/simplified UX, but also lets Compute team record and control application onboarding. [Dedicated vs Shared External Compute Cluster Problem](https://docs.google.com/document/d/1RsG0TPI1P8LDZPV2uX-as0wsp7Wou0NawarmVd6Gp94/edit#heading=h.6gmfqh424w8u) for instance, is a way to leverage Soft Integration.   

\



### UI Mockups

_Include early sketches of the customer experience._

_Proposed UI (draft) is documented at_ <https://docs.google.com/document/d/1h24y-s-tMblQYmFon34zC6R4t0JzlvNt1aM40_xKPNQ/edit> . 

Mock-ups would be built based on an improved version of above.


### Open Issues/Decisions

_Outline specific areas of ambiguity that need to be addressed and the owner for each._

|       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                          |
| ----- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| S.No. | Item                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | Decision                                                                                                                                                                 |
| D01   | When using the CLI, the user needs to first create an environment, then create a data lake with the CDL shape. QUESTION: In which step is the default compute cluster created?                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | When creating environment if the environment is marked –v2 If not, and a default compute cluster doesn’t exist, user needs to add a default compute cluster first.       |
| D02   | Can the user delete the default compute cluster?                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | It can’t be deleted for v2 environments.                                                                                                                                 |
| D04   | Can the user delete an non-default compute cluster. If yes, what happens if there are applications deployed on that cluster?                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | Yes, the applications would be deleted too.                                                                                                                              |
| D05   | What is the upgrade flow mechanism for compute clusters?Is it a side-by-side upgrade ?Or do we drain the nodes one by one?Is it in parallel across NodeGroups (hence hosted services) ?                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | TBD later.There are no upgrades for \~1 year.                                                                                                                            |
| D06   | Who will own the creation of additional cloud resources required by data services ?* NFS for CML

* RDS for CDE

* S3 buckets and KMS keys for DWX                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | Services to continue owning them as they do today via Restricted Roles for Data Services.In the longer term, pod level authentication should mitigate extra privileges.  |
| D07   | Where would the data service specific inputs , for example GPUs, Autoscaling be specified?                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | While provisioning data services.                                                                                                                                        |
| D08   | Will there be a new service maintaining compatibility between compute cluster and service versions? For example- Service X version 1.x works with Compute Version 1.y                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | Technical detail, TBD                                                                                                                                                    |
| D10   | How do we resolve the dependency abyss for upgrading a Shared Externalized Compute Clusters? Even though EKS Standard Support for Kubernetes minor version is 14 months, how data services behave inter-alia:- Development of new features only on >= latest adopted platform version by the data service (features don't back-port to older platform version) * Data Service have \~ 6 month support cycles There will be conditions* Either the customer wants to move to a new service version for features 

* Or the service version is EOSnecessitating platform upgrade before the standard 14 months (every 3-6 months)This is explained in detail at <https://miro.com/app/board/uXjVN40TRUs=/> However, different data services adopt different Kubernetes versions at their own cadence, making synchronization even more challenging. Hence, having a requirement of bridge releases for all services before platform upgrade needs to be considered in more depth.**_We should not do a trade-off between data service feature releases and platform feature releases, as might be the case here_**.These are few possible solutions to this problem:* **CHOSEN - Liftie to set Long time support versions for EKS versions.**

  - EKS has Standard support for a k8s minor version for 14 months and Extended support for 12 more months (at 6x price/cluster) 

  - Liftie could dictate a certain EKS version as LTS. This **SHOULD and MUST** result in data services  using the same platform version for a long time for their releases / bug fixes.- EKS backports security fixes even if the minor version is EOL in k8s but not features.

- _What if the software needs a feature in newer k8s , would that be an exception then, resulting in an out-of-cycle k8s release?_  - Data Services to support development and bug fixes on N-1 releases when Nth release is on a newer k8s .

  - This will need backporting features / fixes to N-1 release for n/M versions. 

  - This will give customers a chance to remain on the same k8s version much longer. 

  - However, data Services teams may not have bandwidth to support and test two underlying platform versions and data service versions at the same time. (there will be a trade-off)* All data services to synchronize  k8s version upgrade.

  - Each data service has a different timeline for adopting a new k8s version supported by Liftie - which is why this problem exists.

  - If data services agree to synchronize the version movement (not lag each other by a week(s)) - shared clusters could be upgraded smoothly via bridge releases.

  - But delays, if any, could cause “NOP compression” - for example , if k8s versions move every 6 month, and a service is late by a couple of months, the total time a customer can stay on the newer version (after upgrading) would be only 4 months (instead of 6).

  - The synchronization problem could become even more complex as we add support for more data/shared services. | There will be no upgrades for \~1 year.Thereafter upgrades will only be LTS -> LTS. Things would become clearer once we have the upgrade design ready.                   |


### Timeline/Release Planning

_What’s the timeline we’re shooting for and what constraints, such as customer delivery timelines, marketing events, competitive announcements, or specific release vehicles do we need to consider._


#### Phases _(Optional)_

What is in scope for Phase ‘x’?  You may add or remove phases.

|                           |         |         |
| ------------------------- | ------- | ------- |
|                           | Phase 1 | Phase 2 |
| Release Date              |         |         |
| Code Freeze               |         |         |
| Engineering Code Complete |         |         |
| QE Start                  |         |         |


### FAQ

_Outline common questions stakeholders asked during reviews and record key decisions._

**What problem does this feature solve?**

Today, the customers have a lacking UX for determining the capabilities of each data service and figuring out the right set of parameters to use them. Further, this is not intuitive for a WorkloadAdmin to manage alone. 

Externalized Compute provides a clear separation of tasks between EnvironmentAdmin and WorkloadAdmin.

For EnvironmentAdmin, it brings in standardization of the compute cluster in terms of common capabilities, parameters’ reference, user authorization and synchronized platform features.

And WorkloadAdmin can install data service with a single click with auto-inferred parameters. 

Moreover, using an existing compute cluster eliminates failure because of Cloud Provider related issues at provisioning time.

**What other competitors have this feature, how does it work and what makes ours better or different?**

Cloud Services Providers, for example Snowflake and Databricks support containerized workloads. Snowflake goes even a step ahead by letting user-built applications (custom containers) run inside a fully managed Snowflake environment (Snowpark Container Services). We aren’t there yet but this is definitely a significant step.  

**What will customers be most excited about?**

They will be happy with the reduction in complexity and improved standardization in our Cloud Product. In addition, they will be able to cut their Cloud Spend with Shared mode.

**What will customers be most disappointed with?**

That it would take time before they’ve the option to provision all current data services on externalized compute clusters. 


###

### Key Questions for QE

**What CDP release(s) will this be tested on?**

Answer: TBD

**What CDP platform will this be tested on (Public Cloud, Private Cloud)?**

Answer: Public Cloud

**What’s the readiness state of this feature at launch (Tech Preview, GA)?**

Answer: Tech Preview

**What is the customer experience around upgrades for this feature?**

Answer: Mentioned in Requirements

**What backward compatibility considerations should we be aware of for this feature?**

Answer: Answered in “Upgrade and Migration Requirements”

**What forward compatibility expectations are there w\.r.t existing or future clients?**

Answer: Answered in “Upgrade and Migration Requirements”

**If there is a UI for this feature, which browsers should be supported?**

Answer: Chrome and Firefox

**Does this feature need to interact or integrate with 3rd party applications?**

Answer: No

**What security implications should we consider when testing this feature?**

Answer: 

Role based access control should be validated inter-alia:

- Separation between EnvironmentAdmin and WorkloadAdmin roles as mentioned in requirements.

- Remote user access at namespace level instead of cluster level.

Restricted IAM policies for Liftie should be used for deployment of externalized compute clusters and data service provisioning.

**What specific resilience testing, or fault injection scenarios should we include in our test plan for this feature (e.g. server crash, network failure, pod crash, faulty data)?**

Answer: 

Few negative scenarios such as:

- Performing a Shared Compute Cluster upgrade when not all hosted data services have been upgraded to bridge releases.

- Installing a data service on a non-compatible compute cluster via CLI/API. 

- Deleting the compute cluster for CDL via CLI/API

- Deleting a compute cluster from just a  WorkloadAdmin role

- Deleting a data service from just an EnvironmentAdmin role

- Deleting a non-default compute cluster which has hosted data services ?

- Making a CDL CDP Environment non v2.

* An AZ outage should be triggered to see if hosted services continue to function (pods being moved to a different node). 

* Injecting a failure while Compute Cluster upgrade and validating that the retry is successful.

\


**What are the key observability, supportability, and troubleshooting scenarios and use cases that should be considered for this feature (e.g. log access, diagnostic bundle data, dashboards, alerts)?**

Answer: Not Applicable since this is a platform service so logs would not be visible to customers directly.

**What are the High Availability (HA) requirements for this feature?**

Answer: Kubernetes Nodes should be deployed Multi-AZ

**What are the general scalability requirements for this feature (e.g. node count, data set sizes, number of databases, etc.)?**

Answer: Not Applicable


## References

[Moving to externalized compute for all new workloads (CML Serving, COD, CDL etc)](https://docs.google.com/document/d/1vunxGy3QFmOjJg5mrjW3wZqbUI543ttoc9KGMBwx84c/edit#heading=h.nbxu4acfu2il)

[Externalized Cluster Decision Points Dump](https://docs.google.com/document/d/1uUWVzDZqGgKVoArjQntNYCF_ltqCWVaTpN8YG2wLs1k/edit)

[Externalized Cluster Upgrade - Use Cases](https://docs.google.com/document/d/19sPSaR7EVDsERatj0GENgOwgXluL8tBqgxXo4YhDm5Y/edit)

[k8s Cluster setup and Life Cycle Management](https://docs.google.com/document/d/1LlNbAnacLc91XyxcTqlHu_AfVZTNvgWOnwPp20yBg3Y/edit)

[Miro](https://miro.com/app/board/uXjVOs207Ps=/)
